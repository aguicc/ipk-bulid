# This is a basic workflow to help you get started with Actions

name: ipk-builder

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          repository: coolsnowwolf/lede
          submodules: recursive
          
      - name: update feeds
        run: |
          cd "$GITHUB_WORKSPAGE"
          sudo apt update
          sudo apt-get install -y build-essential ccache flex gawk gettext git libncurses5-dev libssl-dev python3 python3-distutils rsync unzip zlib1g-dev
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          
      - name: config 
        run: |
          cp .config .config
        
      - name: builder
        run: |
          make defconfig
          make download -j8
          find dl -size -1024c -exec ls -l {} \;
          find dl -size -1024c -exec rm -f {} \;
          echo -e "$(nproc) thread compile"
          make -j$(($(nproc) + 1)) V=s || make -j1 || make -j1 V=s
          
